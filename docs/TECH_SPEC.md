# Техническое задание: InfoHub.ge AI Tax Advisor

## 1. Общая информация о проекте

### 1.1 Наименование проекта
**InfoHub.ge AI Tax Advisor** - интеллектуальная система для работы с налоговой базой данных Грузии

### 1.2 Цель проекта
Создание AI-системы, которая автоматически собирает, обрабатывает и предоставляет информацию по налоговому законодательству Грузии из базы данных infohub.ge с использованием технологий искусственного интеллекта.

### 1.3 Основные задачи
1. Автоматический сбор документов с сайта infohub.ge
2. Обработка и индексация документов
3. Создание векторной базы данных для семантического поиска
4. Интеграция LLM для генерации ответов
5. Предоставление пользовательского интерфейса

### 1.4 Целевая аудитория
- Налоговые консультанты
- Бухгалтеры
- Юристы, специализирующиеся на налоговом праве
- Предприниматели
- Финансовые аналитики

## 2. Функциональные требования

### 2.1 Модуль сбора данных (Web Scraper)

#### 2.1.1 Основные функции
- Автоматический обход сайта infohub.ge
- Извлечение документов всех типов:
  - Законы (საკანონმდებლო აქტები)
  - Подзаконные акты
  - Решения налоговой службы
  - Судебные постановления
  - Разъяснения и инструкции
- Детекция изменений в существующих документах
- Инкрементальные обновления базы данных

#### 2.1.2 Технические требования
- Соблюдение robots.txt
- Rate limiting: не более 5 запросов в секунду
- User-Agent идентификация бота
- Обработка ошибок и retry механизм
- Логирование всех операций

#### 2.1.3 Планировщик
- Ежедневное обновление в 02:00 (настраиваемо)
- Полная переиндексация еженедельно
- Возможность ручного запуска

### 2.2 Модуль обработки документов

#### 2.2.1 Парсинг документов
- Поддержка форматов: PDF, DOCX, HTML, TXT
- OCR для сканированных документов
- Извлечение текста с сохранением структуры
- Определение языка документа (грузинский, русский, английский)

#### 2.2.2 Извлечение метаданных
- Тип документа (закон, постановление, решение и т.д.)
- Номер документа
- Дата публикации
- Дата вступления в силу
- Категория (корпоративный налог, НДС, подоходный налог и т.д.)
- Орган-издатель
- Статус (действующий, отменен, изменен)
- Связанные документы

#### 2.2.3 Разбиение на чанки (Chunking)
- Размер чанка: 512-1024 токена
- Overlap: 10-20% между чанками
- Семантическое разбиение (по статьям, параграфам)
- Сохранение контекста и иерархии

#### 2.2.4 Генерация embeddings
- Использование multilingual модели
- Поддержка грузинского, русского, английского языков
- Размерность вектора: 768
- Batch processing для оптимизации

### 2.3 Модуль хранения данных

#### 2.3.1 Реляционная база данных (PostgreSQL)
**Основные таблицы:**
- `documents`: Метаданные документов
- `document_chunks`: Текстовые фрагменты
- `users`: Пользователи системы
- `conversations`: История диалогов
- `messages`: Сообщения в диалогах
- `document_relations`: Связи между документами

**Требования:**
- ACID транзакции
- Full-text search индексы
- Партиционирование больших таблиц
- Регулярные backups

#### 2.3.2 Векторная база данных (ChromaDB)
- Хранение embeddings для semantic search
- HNSW индекс для быстрого поиска
- Фильтрация по метаданным
- Cosine similarity метрика

#### 2.3.3 Кеш (Redis)
- Кеширование частых запросов (TTL: 1 час)
- Session management
- Rate limiting данные
- Очереди для Celery

### 2.4 RAG система (Retrieval-Augmented Generation)

#### 2.4.1 Retrieval процесс
1. Преобразование запроса в embedding
2. Векторный поиск top-10 релевантных чанков
3. Reranking с помощью cross-encoder (top-5)
4. Извлечение полного контекста из БД
5. Сборка контекста для LLM

#### 2.4.2 Generation процесс
1. Формирование промпта с контекстом
2. Отправка запроса к LLM (OpenAI/Anthropic)
3. Генерация ответа с цитированием источников
4. Форматирование ответа
5. Добавление ссылок на документы

#### 2.4.3 Параметры
- Temperature: 0.3 (для фактической точности)
- Max tokens: 2000
- Top-k retrieval: 10
- Rerank top-k: 5
- Min similarity score: 0.5

### 2.5 API модуль

#### 2.5.1 REST API Endpoints

**Authentication:**
- `POST /api/v1/auth/register` - Регистрация
- `POST /api/v1/auth/login` - Вход
- `POST /api/v1/auth/logout` - Выход
- `POST /api/v1/auth/refresh` - Обновление токена
- `GET /api/v1/auth/me` - Текущий пользователь

**Query:**
- `POST /api/v1/query` - Отправить вопрос
- `POST /api/v1/query/stream` - Streaming ответ
- `GET /api/v1/conversations` - История диалогов
- `GET /api/v1/conversations/{id}` - Конкретный диалог
- `DELETE /api/v1/conversations/{id}` - Удалить диалог

**Documents:**
- `GET /api/v1/documents` - Список документов (с пагинацией)
- `GET /api/v1/documents/{id}` - Получить документ
- `GET /api/v1/documents/search` - Поиск документов
- `GET /api/v1/documents/{id}/related` - Связанные документы

**Admin:**
- `POST /api/v1/admin/scrape` - Запустить scraping
- `GET /api/v1/admin/scrape/status` - Статус scraping
- `GET /api/v1/admin/stats` - Статистика системы
- `GET /api/v1/admin/users` - Управление пользователями
- `POST /api/v1/admin/documents/reindex` - Переиндексация

**Health:**
- `GET /health` - Health check
- `GET /metrics` - Prometheus метрики

#### 2.5.2 WebSocket
- `/ws/query` - Streaming ответы в реальном времени

#### 2.5.3 Аутентификация
- JWT токены (RS256)
- Access token: 30 минут
- Refresh token: 7 дней
- Роли: guest, user, admin

#### 2.5.4 Rate Limiting
- Guest: 10 запросов/минуту
- User: 60 запросов/минуту
- Admin: 1000 запросов/минуту

### 2.6 Frontend модуль

#### 2.6.1 Основные страницы
- Главная страница с чат-интерфейсом
- Страница входа/регистрации
- История диалогов
- Поиск документов
- Admin панель (для администраторов)

#### 2.6.2 Чат интерфейс
- Ввод текстового вопроса
- Streaming ответ (реального времени)
- Отображение источников с ссылками
- История диалога
- Возможность копирования ответа
- Markdown рендеринг

#### 2.6.3 Дополнительные функции
- Темная/светлая тема
- Мультиязычность (грузинский, русский, английский)
- Responsive design (адаптация под мобильные)
- Экспорт диалогов в PDF

## 3. Нефункциональные требования

### 3.1 Производительность
- Время ответа API: < 200ms (без LLM)
- Время генерации ответа: < 10 секунд
- Поддержка 100 одновременных пользователей
- Векторный поиск: < 500ms для 1M документов

### 3.2 Масштабируемость
- Horizontal scaling через Docker Swarm/Kubernetes
- Database sharding для больших объемов
- Load balancing между API серверами
- CDN для статических ресурсов

### 3.3 Надежность
- Availability: 99.5% (цель)
- Graceful degradation при сбоях
- Автоматический retry для failed операций
- Health checks для всех сервисов
- Регулярные backups (ежедневно)

### 3.4 Безопасность
- HTTPS обязателен в production
- JWT authentication
- Password hashing (bcrypt)
- SQL injection защита (ORM)
- XSS защита
- CORS настройки
- Rate limiting
- API key rotation
- Логирование security events
- GDPR compliance

### 3.5 Мониторинг и логирование
- Structured logging (JSON формат)
- Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL
- Prometheus metrics
- Alerting при критических ошибках
- Performance profiling
- User activity tracking

### 3.6 Backup и Recovery
- PostgreSQL: Full backup ежедневно + incremental каждый час
- Vector DB: Full backup еженедельно
- Redis: AOF persistence
- Retention: 30 дней
- RTO: 1 час
- RPO: 1 час

### 3.7 Совместимость
**Браузеры:**
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**Платформы:**
- Linux (production)
- Windows (development)
- macOS (development)

## 4. Технологический стек

### 4.1 Backend
- **Language**: Python 3.11+
- **Framework**: FastAPI 0.109+
- **ORM**: SQLAlchemy 2.0+
- **Task Queue**: Celery 5.3+
- **Web Scraping**: Scrapy 2.11+
- **AI/ML**: LangChain, OpenAI/Anthropic

### 4.2 Frontend
- **Framework**: Next.js 14+
- **Language**: TypeScript
- **Styling**: TailwindCSS
- **UI Components**: shadcn/ui
- **State Management**: Zustand + React Query

### 4.3 Databases
- **Relational**: PostgreSQL 15+
- **Vector**: ChromaDB 0.4+
- **Cache**: Redis 7+

### 4.4 Infrastructure
- **Containerization**: Docker + Docker Compose
- **Web Server**: Nginx
- **CI/CD**: GitHub Actions
- **Monitoring**: Prometheus + Grafana

## 5. Этапы реализации

### Phase 1: Infrastructure (2 недели)
- Настройка Docker окружения
- Создание базовой структуры проекта
- Настройка баз данных
- CI/CD pipeline

### Phase 2: Data Collection (2 недели)
- Разработка web scraper
- Реализация парсеров документов
- Интеграция с БД
- Тестирование на реальных данных

### Phase 3: RAG System (3 недели)
- Настройка векторной БД
- Интеграция embedding модели
- Реализация retrieval механизма
- Интеграция LLM
- Тестирование качества ответов

### Phase 4: API Development (2 недели)
- Разработка REST API
- Аутентификация и авторизация
- Rate limiting
- Документация API

### Phase 5: Frontend (3 недели)
- Создание UI компонентов
- Реализация чат интерфейса
- Admin панель
- Интеграция с backend

### Phase 6: Testing & Deployment (2 недели)
- Unit и integration тесты
- Performance тестирование
- Security audit
- Production deployment
- Мониторинг настройка

**Общая продолжительность: 14 недель (~3.5 месяца)**

## 6. Риски и митигация

### 6.1 Технические риски
| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Блокировка IP при scraping | Средняя | Высокое | Rate limiting, proxy rotation |
| Изменение структуры infohub.ge | Средняя | Высокое | Мониторинг, быстрое обновление парсеров |
| Недостаточное качество embeddings для грузинского | Средняя | Среднее | Тестирование нескольких моделей |
| Высокие расходы на LLM API | Высокая | Среднее | Кеширование, оптимизация промптов |
| Проблемы с масштабированием | Низкая | Высокое | Load testing, horizontal scaling |

### 6.2 Правовые риски
| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Нарушение авторских прав | Низкая | Высокое | Использование публичных данных, disclaimer |
| GDPR нарушения | Низкая | Высокое | Privacy by design, data minimization |

## 7. Критерии приемки

### 7.1 Функциональные критерии
- ✓ Система собирает все документы с infohub.ge
- ✓ Поиск работает на грузинском, русском, английском
- ✓ Ответы содержат ссылки на источники
- ✓ Пользователи могут зарегистрироваться и войти
- ✓ История диалогов сохраняется
- ✓ Admin панель позволяет управлять системой

### 7.2 Технические критерии
- ✓ API response time < 200ms
- ✓ Генерация ответа < 10 секунд
- ✓ Поддержка 100 одновременных пользователей
- ✓ Test coverage > 80%
- ✓ Availability > 99%

### 7.3 Качество кода
- ✓ Соответствие PEP 8 (Python)
- ✓ TypeScript strict mode
- ✓ Документация всех API endpoints
- ✓ README с инструкциями по запуску

## 8. Поддержка и развитие

### 8.1 Техническая поддержка
- Мониторинг 24/7
- Response time для критических ошибок: 1 час
- Bug fixes: в течение 48 часов
- Регулярные обновления безопасности

### 8.2 Будущие улучшения
- Fine-tuning модели на налоговом домене Грузии
- Голосовой интерфейс
- Mobile приложения (iOS, Android)
- Интеграция с бухгалтерскими системами
- Advanced analytics и insights
- Multi-tenancy для организаций

## 9. Документация

### 9.1 Обязательная документация
- README.md - Обзор проекта
- ARCHITECTURE.md - Архитектура системы
- DEPLOYMENT.md - Инструкции по развертыванию
- API.md - API документация
- CONTRIBUTING.md - Руководство для разработчиков
- Swagger/OpenAPI спецификация

### 9.2 Пользовательская документация
- User Guide - Руководство пользователя
- FAQ - Частые вопросы
- Video tutorials - Видео инструкции

## 10. Контакты

**Project Manager**: [Имя]  
**Email**: project@yourcompany.com  
**Repository**: https://github.com/yourusername/infohub-ai-tax-advisor  

---

**Дата создания**: 2024-12-06  
**Версия**: 1.0  
**Статус**: Draft
